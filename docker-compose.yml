services:
  runner:
    image: myoung34/github-runner:latest
    container_name: github-actions-runner
    environment:
      GITHUB_HOST: github.com
      GITHUB_OWNER: ${GITHUB_OWNER}
      GITHUB_REPOSITORY: ${GITHUB_REPOSITORY}
      REPO_URL: https://github.com/${GITHUB_OWNER}/${GITHUB_REPOSITORY}
      ORG_NAME: ${GITHUB_OWNER}
      RUNNER_NAME: ${RUNNER_NAME}
      RUNNER_LABELS: ${RUNNER_LABELS:-self-hosted,linux,x64}
      ACCESS_TOKEN: ${ACCESS_TOKEN}
      RUNNER_TOKEN: ${REGISTRATION_TOKEN}
      ORG_RUNNER: ${ORG_RUNNER}
      RUNNER_WORKSPACE: /tmp/runner/work
      RUNNER_GROUP: Default
      EPHEMERAL: ${EPHEMERAL:-false}
      DISABLE_UPDATE: ${DISABLE_UPDATE:-false}
      RUNNER_SCOPE: ${RUNNER_SCOPE}
      # Polling configuration (optional)
      # ACTIONS_RUNNER_POLLING_INTERVAL: 5  # Seconds between polls (default: 5)
      # ACTIONS_RUNNER_POLLING_TIMEOUT: 60   # How long to wait for response (default: 60)
    env_file:
      - .env
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - runner-work:/tmp/runner/work
      - runner-config:/etc/runner
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
        reservations:
          cpus: '2'
          memory: 4G
    networks:
      - runner-network

volumes:
  runner-work:
  runner-config:

networks:
  runner-network:
    driver: bridge
